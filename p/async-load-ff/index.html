<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='By Claire Xenia Wolf'><title>Why Asynchronous Load Flip-Flops Should Be Avoided</title>

<link rel='canonical' href='http://blog.yosyshq.com/p/async-load-ff/'>

<link rel="stylesheet" href="/scss/style.min.css"><meta property='og:title' content='Why Asynchronous Load Flip-Flops Should Be Avoided'>
<meta property='og:description' content='By Claire Xenia Wolf'>
<meta property='og:url' content='http://blog.yosyshq.com/p/async-load-ff/'>
<meta property='og:site_name' content='YosysHQ Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2021-11-30T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2021-11-30T00:00:00&#43;00:00'/><meta property='og:image' content='http://blog.yosyshq.com/static-2021/asyncff.png' />
<meta name="twitter:site" content="@YosysHQ"><meta name="twitter:title" content="Why Asynchronous Load Flip-Flops Should Be Avoided">
<meta name="twitter:description" content="By Claire Xenia Wolf"><meta name="twitter:card" content="summary">
    <meta name="twitter:image" content='http://blog.yosyshq.com/static-2021/asyncff.png' />
    <link rel="shortcut icon" href="/favicon.png" />

    </head>
    <body class="">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.body.dataset.scheme = 'dark';
        } else {
            document.body.dataset.scheme = 'light';
        }
    })();
</script><div class="container main-container flex on-phone--column extended article-page with-toolbar">
            <aside class="sidebar left-sidebar sticky">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header class="site-info">
        
            <figure class="site-avatar">
                
                    
                    
                    
                        
                        <img src="/logos/YOS_mark_square_hu6bb8cbdbd2526742846cc00545eb2d90_33709_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                

                
            </figure>
        
        <h1 class="site-name"><a href="http://blog.yosyshq.com/">YosysHQ Blog</a></h1>
        <h2 class="site-description"></h2>
    </header>

    <ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        

        <li >
            <a href='/about'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        

        <li >
            <a href='/newsletter'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>Newsletter</span>
            </a>
        </li>
        
        

        <li >
            <a href='/archives'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        

        
            <li id="dark-mode-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                <span>Dark Mode</span>
            </li>
        
    </ol>
</aside>

            <main class="main full-width">
    <div id="article-toolbar">
        <a href="http://blog.yosyshq.com/" class="back-home">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



            <span>Back</span>
        </a>
    </div>

    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/async-load-ff/">
                
                    <img src="/static-2021/asyncff.png" loading="lazy" alt="Featured image of post Why Asynchronous Load Flip-Flops Should Be Avoided" />
                
            </a>
        </div>
    

    <div class="article-details">
    

    <h2 class="article-title">
        <a href="/p/async-load-ff/">Why Asynchronous Load Flip-Flops Should Be Avoided</a>
    </h2>

    
    <h3 class="article-subtitle">
        By Claire Xenia Wolf
    </h3>
    <footer class="article-time">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <time class="article-time--published">Nov 30, 2021</time>
    </footer></div>
</header>

    <section class="article-content">
    <p>Code: <a class="link" href="https://github.com/YosysHQ-Docs/Blog-Async-Load-FFs"  target="_blank" rel="noopener"
    >https://github.com/YosysHQ-Docs/Blog-Async-Load-FFs</a></p>
<h2 id="part-1-the-bad-news">Part 1: The Bad News</h2>
<p>We have recently added support for asynchronous load flip-flops to Yosys for a customer project. However, we consider this a problematic feature in a (System-)Verilog synthesis tool, and thus I’d like to take this opportunity to explain why one should avoid using asynchronous load flip-flops in new (System-)Verilog designs.</p>
<h3 id="what-are-asynchronous-load-flip-flops">What are asynchronous load flip-flops</h3>
<p>An asynchronous load flip-flop is a type of flip-flop with asynchronous reset for which the reset value is not a compile-time / synthesis-time constant.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SystemVerilog" data-lang="SystemVerilog"><span class="line"><span class="cl"><span class="k">reg</span> <span class="n">async_load_ff_q</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">wire</span> <span class="n">async_load_ff_reset_val</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">dynamic_expression</span><span class="o">&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">always_ff</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clock</span><span class="p">,</span> <span class="k">posedge</span> <span class="n">load</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">load</span><span class="p">)</span> <span class="n">async_load_ff_q</span> <span class="o">&lt;=</span> <span class="n">async_load_ff_reset_val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>      <span class="n">async_load_ff_q</span> <span class="o">&lt;=</span> <span class="p">...;</span>
</span></span></code></pre></div><p>This distinguishes them from the more common asynchronous set (reset) flip-flops, for which the reset value is a compile-time (synthesis-time) constant.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SystemVerilog" data-lang="SystemVerilog"><span class="line"><span class="cl"><span class="k">reg</span> <span class="n">async_reset_ff_q</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">localparam</span> <span class="n">async_reset_ff_reset_val</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">constant_expression</span><span class="o">&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">always_ff</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clock</span><span class="p">,</span> <span class="k">posedge</span> <span class="n">reset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">reset</span><span class="p">)</span> <span class="n">async_reset_ff_q</span> <span class="o">&lt;=</span> <span class="n">async_reset_ff_reset_val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>       <span class="n">async_reset_ff_q</span> <span class="o">&lt;=</span> <span class="p">...;</span>
</span></span></code></pre></div><p>IEEE Std 1364.1-2002, the IEEE Standard for Verilog Register Transfer Level Synthesis, does allow such asynchronous load flip-flops in synthesis, but states that the synthesis results will only match the behavior of the original Verilog code under certain conditions.</p>
<h3 id="the-problem-with-verilog-and-asynchronous-load-flip-flops">The problem with Verilog and asynchronous load flip-flops</h3>
<p>The key insight is that the way an asynchronous reset is modelled using Verilog always blocks is not sensitive to the data signals providing the asynchronous load value. Thus, if the data signals are changing while the asynchronous reset is active, the new data is not loaded into the flip-flop when neither clock nor the asynchronous reset is toggling.</p>
<p>Consider the following SystemVerilog design (<a class="link" href="https://github.com/YosysHQ-Docs/Blog-Async-Load-FFs/blob/main/dut.sv"  target="_blank" rel="noopener"
    >dut.sv</a>):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SystemVerilog" data-lang="SystemVerilog"><span class="line"><span class="cl"><span class="k">module</span> <span class="n">dut</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="k">input</span> <span class="n">clk1</span><span class="p">,</span> <span class="n">clk2</span><span class="p">,</span> <span class="n">arst</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">output</span> <span class="k">reg</span> <span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">cnt1</span><span class="p">,</span> <span class="n">cnt2</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">always_ff</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk1</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">arst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">arst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">cnt1</span> <span class="o">&lt;=</span> <span class="mh">0</span><span class="p">;</span>  <span class="c1">// constant expression (async reset)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">else</span>
</span></span><span class="line"><span class="cl">            <span class="n">cnt1</span> <span class="o">&lt;=</span> <span class="n">cnt1</span> <span class="o">+</span> <span class="mh">7</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">always_ff</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk2</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">arst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">arst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">cnt2</span> <span class="o">&lt;=</span> <span class="n">cnt1</span><span class="p">;</span>  <span class="c1">// dynamic expression (async load)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">else</span>
</span></span><span class="line"><span class="cl">            <span class="n">cnt2</span> <span class="o">&lt;=</span> <span class="n">cnt2</span> <span class="o">+</span> <span class="mh">11</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">endmodule</span>
</span></span></code></pre></div><p>And the following test bench (<a class="link" href="https://github.com/YosysHQ-Docs/Blog-Async-Load-FFs/blob/main/tb.sv"  target="_blank" rel="noopener"
    >tb.sv</a>):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SystemVerilog" data-lang="SystemVerilog"><span class="line"><span class="cl"><span class="k">module</span> <span class="n">tb</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">reg</span> <span class="n">clk1</span> <span class="o">=</span> <span class="mh">0</span><span class="p">,</span> <span class="n">clk2</span> <span class="o">=</span> <span class="mh">0</span><span class="p">,</span> <span class="n">arst</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">wire</span> <span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">cnt1</span><span class="p">,</span> <span class="n">cnt2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">dut</span> <span class="n">dut</span> <span class="p">(</span><span class="n">clk1</span><span class="p">,</span> <span class="n">clk2</span><span class="p">,</span> <span class="n">arst</span><span class="p">,</span> <span class="n">cnt1</span><span class="p">,</span> <span class="n">cnt2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">task</span> <span class="n">do_clk1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">clk1</span> <span class="o">=</span> <span class="mh">1</span><span class="p">;</span> <span class="p">#</span><span class="mh">5</span><span class="p">;</span> <span class="n">clk1</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span> <span class="p">#</span><span class="mh">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">endtask</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">task</span> <span class="n">do_clk2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">clk2</span> <span class="o">=</span> <span class="mh">1</span><span class="p">;</span> <span class="p">#</span><span class="mh">5</span><span class="p">;</span> <span class="n">clk2</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span> <span class="p">#</span><span class="mh">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">endtask</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">task</span> <span class="n">do_arst</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">arst</span> <span class="o">=</span> <span class="mh">1</span><span class="p">;</span> <span class="p">#</span><span class="mh">5</span><span class="p">;</span> <span class="n">arst</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span> <span class="p">#</span><span class="mh">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="no">`ifdef</span> <span class="n">DOUBLE_ARST</span>
</span></span><span class="line"><span class="cl">        <span class="n">arst</span> <span class="o">=</span> <span class="mh">1</span><span class="p">;</span> <span class="p">#</span><span class="mh">5</span><span class="p">;</span> <span class="n">arst</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span> <span class="p">#</span><span class="mh">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="no">`endif</span>
</span></span><span class="line"><span class="cl">    <span class="k">endtask</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">initial</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="p">#</span><span class="mh">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">do_arst</span><span class="p">;</span>              <span class="nb">$display</span><span class="p">(</span><span class="n">cnt1</span><span class="p">,</span> <span class="n">cnt2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">repeat</span> <span class="p">(</span><span class="mh">5</span><span class="p">)</span> <span class="n">do_clk1</span><span class="p">;</span>   <span class="nb">$display</span><span class="p">(</span><span class="n">cnt1</span><span class="p">,</span> <span class="n">cnt2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">do_arst</span><span class="p">;</span>              <span class="nb">$display</span><span class="p">(</span><span class="n">cnt1</span><span class="p">,</span> <span class="n">cnt2</span><span class="p">,</span> <span class="s">&#34; &lt;--&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">repeat</span> <span class="p">(</span><span class="mh">5</span><span class="p">)</span> <span class="n">do_clk2</span><span class="p">;</span>   <span class="nb">$display</span><span class="p">(</span><span class="n">cnt1</span><span class="p">,</span> <span class="n">cnt2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">do_arst</span><span class="p">;</span>              <span class="nb">$display</span><span class="p">(</span><span class="n">cnt1</span><span class="p">,</span> <span class="n">cnt2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl"><span class="k">endmodule</span>
</span></span></code></pre></div><p>Running it without and with <code>-DDOUBLE_ARST</code> produces the following output:</p>
<pre tabindex="0"><code>$ make run0
iverilog -g2012 -o sim0 -s tb tb.sv dut.sv
./sim0
  0  x
 35  x
  0 35 &lt;--
  0 90
  0  0

$ make run1
iverilog -g2012 -o sim1 -s tb -DDOUBLE_ARST tb.sv dut.sv
./sim1
  0  0
 35  0
  0  0 &lt;--
  0 55
  0  0
</code></pre><p>In the first case with a single pulse on arst, the second counter is reset to the non-zero value of the first counter from before the reset pulse.</p>
<p>But a real-world asynchronous load flip-flop would of course behave like a transparent latch while the reset pulse is high, propagating the new (zero) value of the first counter to the second counter register. But this only happens in simulation when we pulse the reset signal a second time.</p>
<p><img src="/static-2021/asyncff.png" alt="Double-Async-Reset Waveform"  /></p>
<p>This can lead to non-trivial simulation-synthesis mismatches that are hard to debug, and may result in a chip that does not function as expected.</p>
<p>Thus, asynchronous load flip-flops should be avoided in (System)Verilog designs, or at least it should be formally verified that the asynchronous load value of such a flip-flop can never change while the reset signal is active.</p>
<p>This is in line with IEEE Std 1364.1-2002 requirements for sequential logic verification:</p>
<blockquote>
<p>When asynchronous data is assigned, the asynchronous data shall not change during the period in which the asynchronous control (the condition under which the data is assigned) is active.</p>
<p><em>IEEE Std 1364.1-2002, Section 4.2</em></p>
</blockquote>
<p>It is worth noting that a similar problem exists with flip-flops that have both asynchronous set and reset: If both are asserted and then one is released after the other, the one that’s released later should take precedence over the one that’s released earlier. However, since the always block is not triggered by the falling edge of the set or reset signal, releasing just one of the two will have no effect on the flip-flop output. IEEE Std 1364.1-2002 also acknowledges this issue:</p>
<blockquote>
<p>The problem occurs when both reset and preset are asserted at the same time and reset is removed first. When reset is removed (posedge rst_n), the always block is not activated. This means that the output will continue to drive the reset output to ‘0’ until the next rising clock edge. A real flip-flop of this type would immediately drive the output to ‘1’ because the set_n signal is an asynchronous preset. This potentially could cause a mismatch between pre-synthesis and post-synthesis simulations using this model.</p>
<p><em>IEEE Std 1364.1-2002, Appendix B.6</em></p>
</blockquote>
<h2 id="part-2-the-good-news">Part 2: The Good News</h2>
<p>In this section we discuss different design methods that avoid the use of behavioral Verilog code to model asynchronous load FFs.</p>
<h3 id="instantiate-vendor-primitives">Instantiate (Vendor) Primitives</h3>
<p>The best and easiest way of dealing with this issue is to instantiate FF primitives directly. This can either be vendor cells, or a user-defined module for which we chose different implementations for simulation and synthesis, one with correct simulation behavior, and one that is synthesizable, respectively.</p>
<p>The new DUT would look something like this (<a class="link" href="https://github.com/YosysHQ-Docs/Blog-Async-Load-FFs/blob/main/dut_myff.sv"  target="_blank" rel="noopener"
    >dut_myff.sv</a>):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SystemVerilog" data-lang="SystemVerilog"><span class="line"><span class="cl"><span class="k">module</span> <span class="n">dut</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="k">input</span> <span class="n">clk1</span><span class="p">,</span> <span class="n">clk2</span><span class="p">,</span> <span class="n">arst</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">output</span> <span class="k">reg</span> <span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">cnt1</span><span class="p">,</span> <span class="n">cnt2</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">myff</span> <span class="n">ff1</span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="p">(</span><span class="n">cnt1</span><span class="p">,</span> <span class="n">cnt1</span> <span class="o">+</span> <span class="mh">8</span><span class="p">&#39;</span><span class="n">d</span>  <span class="mh">7</span><span class="p">,</span> <span class="n">clk1</span><span class="p">,</span> <span class="n">arst</span><span class="p">,</span> <span class="mh">8</span><span class="p">&#39;</span><span class="n">h</span> <span class="mh">00</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">         <span class="n">ff2</span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="p">(</span><span class="n">cnt2</span><span class="p">,</span> <span class="n">cnt2</span> <span class="o">+</span> <span class="mh">8</span><span class="p">&#39;</span><span class="n">d</span> <span class="mh">11</span><span class="p">,</span> <span class="n">clk2</span><span class="p">,</span> <span class="n">arst</span><span class="p">,</span>   <span class="n">cnt1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">endmodule</span>
</span></span></code></pre></div><p>When instantiating a Vendor primitive one should always double-check that the vendor simulation library does model asynchronous loads correctly, for example using the techniques described in the next two sections.</p>
<h3 id="simulation-model-using-verilog-udp">Simulation model using Verilog UDP</h3>
<p>Verilog UDP primitives can be used to correctly model the behavior of asynchronous load flip-flops. But UDPs are not synthesizable, so we need to also provide a synthesizable implementation of an asynchronous load flip-flop (<a class="link" href="https://github.com/YosysHQ-Docs/Blog-Async-Load-FFs/blob/main/myff_udp.sv"  target="_blank" rel="noopener"
    >myff_udp.sv</a>):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SystemVerilog" data-lang="SystemVerilog"><span class="line"><span class="cl"><span class="no">`ifdef</span> <span class="n">SYNTHESIS</span>
</span></span><span class="line"><span class="cl">    <span class="k">module</span> <span class="n">myff</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="k">output</span> <span class="k">reg</span> <span class="n">q</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="k">input</span> <span class="n">d</span><span class="p">,</span> <span class="n">clk</span><span class="p">,</span> <span class="n">arst</span><span class="p">,</span> <span class="n">rval</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">arst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">arst</span><span class="p">)</span> <span class="n">q</span> <span class="o">&lt;=</span> <span class="n">rval</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span>      <span class="n">q</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">endmodule</span>
</span></span><span class="line"><span class="cl"><span class="no">`else</span>
</span></span><span class="line"><span class="cl">    <span class="k">primitive</span> <span class="n">myff</span> <span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">clk</span><span class="p">,</span> <span class="n">arst</span><span class="p">,</span> <span class="n">rval</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">input</span> <span class="n">d</span><span class="p">,</span> <span class="n">clk</span><span class="p">,</span> <span class="n">arst</span><span class="p">,</span> <span class="n">rval</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">reg</span> <span class="n">q</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">output</span> <span class="n">q</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">table</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// D C R V : Q : Q&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="o">?</span> <span class="o">?</span> <span class="mh">1</span> <span class="mh">0</span> <span class="o">:</span> <span class="o">?</span> <span class="o">:</span> <span class="mh">0</span> <span class="p">;</span> <span class="c1">// async reset
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="o">?</span> <span class="o">?</span> <span class="mh">1</span> <span class="mh">1</span> <span class="o">:</span> <span class="o">?</span> <span class="o">:</span> <span class="mh">1</span> <span class="p">;</span> <span class="c1">// async set
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="mh">0</span> <span class="n">p</span> <span class="mh">0</span> <span class="o">?</span> <span class="o">:</span> <span class="o">?</span> <span class="o">:</span> <span class="mh">0</span> <span class="p">;</span> <span class="c1">// posedge clock, d=0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="mh">1</span> <span class="n">p</span> <span class="mh">0</span> <span class="o">?</span> <span class="o">:</span> <span class="o">?</span> <span class="o">:</span> <span class="mh">1</span> <span class="p">;</span> <span class="c1">// posedge clock, d=1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="o">?</span> <span class="n">n</span> <span class="mh">0</span> <span class="o">?</span> <span class="o">:</span> <span class="o">?</span> <span class="o">:</span> <span class="o">-</span> <span class="p">;</span> <span class="c1">// negedge clock
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="o">*</span> <span class="o">?</span> <span class="o">?</span> <span class="o">?</span> <span class="o">:</span> <span class="o">?</span> <span class="o">:</span> <span class="o">-</span> <span class="p">;</span> <span class="c1">// any data edge
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="o">?</span> <span class="o">?</span> <span class="o">*</span> <span class="o">?</span> <span class="o">:</span> <span class="o">?</span> <span class="o">:</span> <span class="o">-</span> <span class="p">;</span> <span class="c1">// any arst edge
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="o">?</span> <span class="o">?</span> <span class="o">?</span> <span class="o">*</span> <span class="o">:</span> <span class="o">?</span> <span class="o">:</span> <span class="o">-</span> <span class="p">;</span> <span class="c1">// any rval edge
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">endtable</span>
</span></span><span class="line"><span class="cl">    <span class="k">endprimitive</span>
</span></span><span class="line"><span class="cl"><span class="no">`endif</span>
</span></span></code></pre></div><p>Running our test-bench now yields the expected result, even when we pulse the asynchronous load signal only once:</p>
<pre tabindex="0"><code>$ make run2
iverilog -g2012 -o sim2 -s tb tb.sv dut_myff.sv myff_udp.sv
./sim2
  0  0
 35  0
  0  0 &lt;--
  0 55
  0  0
</code></pre><h3 id="simulation-model-using-procedural-assign-and-deassign">Simulation model using procedural assign and deassign</h3>
<p>Another approach is to “fix up” the asynchronous load using procedural assign and deassign (<a class="link" href="https://github.com/YosysHQ-Docs/Blog-Async-Load-FFs/blob/main/myff_ada.sv"  target="_blank" rel="noopener"
    >myff_ada.sv</a>):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SystemVerilog" data-lang="SystemVerilog"><span class="line"><span class="cl"><span class="k">module</span> <span class="n">myff</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="k">output</span> <span class="k">reg</span> <span class="n">q</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">input</span> <span class="n">d</span><span class="p">,</span> <span class="n">clk</span><span class="p">,</span> <span class="n">arst</span><span class="p">,</span> <span class="n">rval</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">always_ff</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">arst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">arst</span><span class="p">)</span> <span class="n">q</span> <span class="o">&lt;=</span> <span class="n">rval</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>      <span class="n">q</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="no">`ifndef</span> <span class="n">SYNTHESIS</span>
</span></span><span class="line"><span class="cl">    <span class="k">always</span> <span class="p">@(</span><span class="n">arst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">arst</span><span class="p">)</span> <span class="k">assign</span> <span class="n">q</span> <span class="o">=</span> <span class="n">rval</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>    <span class="k">deassign</span> <span class="n">q</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="no">`endif</span>
</span></span><span class="line"><span class="cl"><span class="k">endmodule</span>
</span></span></code></pre></div><p>Running our test-bench on this version also yields the expected result:</p>
<pre tabindex="0"><code>iverilog -g2012 -o sim3 -s tb tb.sv dut_myff.sv myff_ada.sv
./sim3
  0  0
 35  0
  0  0 &lt;--
  0 55
  0  0
</code></pre><p>Of course it’s also possible to use procedural assign and deassign directly in the design to “fix up” the behavior of asynchronous load flip-flops (<a class="link" href="https://github.com/YosysHQ-Docs/Blog-Async-Load-FFs/blob/main/dut_ada.sv"  target="_blank" rel="noopener"
    >dut_ada.sv</a>):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SystemVerilog" data-lang="SystemVerilog"><span class="line"><span class="cl"><span class="k">module</span> <span class="n">dut</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="k">input</span> <span class="n">clk1</span><span class="p">,</span> <span class="n">clk2</span><span class="p">,</span> <span class="n">arst</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">output</span> <span class="k">reg</span> <span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">cnt1</span><span class="p">,</span> <span class="n">cnt2</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">always_ff</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk1</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">arst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">arst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">cnt1</span> <span class="o">&lt;=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">            <span class="n">cnt1</span> <span class="o">&lt;=</span> <span class="n">cnt1</span> <span class="o">+</span> <span class="mh">7</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">always_ff</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk2</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">arst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">arst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">cnt2</span> <span class="o">&lt;=</span> <span class="n">cnt1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">            <span class="n">cnt2</span> <span class="o">&lt;=</span> <span class="n">cnt2</span> <span class="o">+</span> <span class="mh">11</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="no">`ifndef</span> <span class="n">SYNTHESIS</span>
</span></span><span class="line"><span class="cl">    <span class="k">always</span> <span class="p">@(</span><span class="n">arst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">arst</span><span class="p">)</span> <span class="k">assign</span> <span class="n">cnt2</span> <span class="o">=</span> <span class="n">cnt1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>    <span class="k">deassign</span> <span class="n">cnt2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="no">`endif</span>
</span></span><span class="line"><span class="cl"><span class="k">endmodule</span>
</span></span></code></pre></div><p>However, sprinkling procedural assign and deassign statements and ifndef-SYNTHESIS-blocks all over the design is much more error prone than implementing this work-around only once in a custom cell type that can then be instantiated wherever needed.</p>
<h3 id="the-latchflip-flop-trick">The latch+flip-flop trick</h3>
<p>The following technique is used on some FPGA architectures to emulate asynchronous-load flip-flops using latches and asynchronous-reset flip-flops only. It can be used to completely avoid asynchronous-load FFs while preserving the semantic of such elements (<a class="link" href="https://github.com/YosysHQ-Docs/Blog-Async-Load-FFs/blob/main/myff_hack.sv"  target="_blank" rel="noopener"
    >myff_hack.sv</a>):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SystemVerilog" data-lang="SystemVerilog"><span class="line"><span class="cl"><span class="k">module</span> <span class="n">myff</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="k">output</span> <span class="n">q</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">input</span> <span class="n">d</span><span class="p">,</span> <span class="n">clk</span><span class="p">,</span> <span class="n">arst</span><span class="p">,</span> <span class="n">rval</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// a latch to store the async-load value
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">reg</span> <span class="n">latched_rval</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">always</span> <span class="p">@</span><span class="o">*</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">arst</span><span class="p">)</span> <span class="n">latched_rval</span> <span class="o">=</span> <span class="n">rval</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// a regular FF to store the clocked data value
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">reg</span> <span class="n">q_without_reset</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">q_without_reset</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// an asynchronous-reset flip-flop to remember last event
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">reg</span> <span class="n">last_event_was_clock</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">arst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">arst</span><span class="p">)</span> <span class="n">last_event_was_clock</span> <span class="o">&lt;=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>      <span class="n">last_event_was_clock</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// output either the latched reset value or clocked data value
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">assign</span> <span class="n">q</span> <span class="o">=</span> <span class="n">last_event_was_clock</span> <span class="o">?</span> <span class="n">q_without_reset</span> <span class="o">:</span> <span class="n">latched_rval</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">endmodule</span>
</span></span></code></pre></div><p>Running our test-bench a last time gives the expected result for this solution as well:</p>
<pre tabindex="0"><code>iverilog -g2012 -o sim5 -s tb tb.sv dut_myff.sv myff_hack.sv
./sim5
  0  0
 35  0
  0  0 &lt;--
  0 55
  0  0
</code></pre><p>This is a useful last resort solution for designs that absolutely require asynchronous-load flip-flop semantics, and where the risks associated with using different synthesis and simulation models for such a component are not acceptable.</p>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>

    
</article>

    <aside class="related-contents--wrapper">
    
    
</aside>


    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2024 YosysHQ Blog
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="2.2.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >
            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
